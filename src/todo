
/* Copyright (C) 2013  Stephan Kreutzer
 *
 * This file is part of RPGBGPrototype.
 *
 * RPGBGPrototype is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License version 3 or any later version,
 * as published by the Free Software Foundation.
 *
 * RPGBGPrototype is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Affero General Public License 3 for more details.
 *
 * You should have received a copy of the GNU Affero General Public License 3
 * along with RPGBGPrototype. If not, see <http://www.gnu.org/licenses/>.
 */





if (isset($_POST['north']) === true ||
    isset($_POST['east']) === true ||
    isset($_POST['south']) === true ||
    isset($_POST['west']) === true)
{
    require_once("../libraries/gamelib.inc.php");

    if (isset($_POST['north']) === true)
    {
        setPosition($_SESSION['user_id'], $position['x'], $position['y'] - 1);
        unset($_POST['north']);
    }
    else if (isset($_POST['east']) === true)
    {
        setPosition($_SESSION['user_id'], $position['x'] + 1, $position['y']);
        unset($_POST['east']);
    }
    else if (isset($_POST['south']) === true)
    {
        setPosition($_SESSION['user_id'], $position['x'], $position['y'] + 1);
        unset($_POST['south']);
    }
    else if (isset($_POST['west']) === true)
    {
        setPosition($_SESSION['user_id'], $position['x'] - 1, $position['y']);
        unset($_POST['west']);
    }

    $position['x'] = $_SESSION['positionX'];
    $position['y'] = $_SESSION['positionY'];
}



$positionText = "";

if (file_exists("../positioncode/".$position['x']."_".$position['y'].".inc.php") === true)
{
    $positionText .= require_once("../positioncode/".$position['x']."_".$position['y'].".inc.php");

    if ($position['x'] !== $_SESSION['positionX'] ||
        $position['y'] !== $_SESSION['positionY'])
    {
        // Position changed within the require_once() above (maybe as a result
        // of an "teleport" option on the previous position).

        $position['x'] = $_SESSION['positionX'];
        $position['y'] = $_SESSION['positionY'];

        if (file_exists("../positioncode/".$position['x']."_".$position['y'].".inc.php") === true)
        {
            $positionText .= require_once("../positioncode/".$position['x']."_".$position['y'].".inc.php");
        }
    }
}


/*
//echo "position is: ".$position['x'].",".$position['y']."<hr>";

echo "        <div>\n".
     "          <a href=\"inventory.php\">Inventar</a>.\n".
     "          <hr />\n".
     "        </div>\n";
*/


echo "            <div>\n".
     "              <form action=\"game.php\" method=\"post\">\n".
     "                <table border=\"0\">\n".
     "                  <tr>\n".
     "                    <td></td>\n".
     "                    <td><input type=\"submit\" name=\"north\" value=\"N\"/></td>\n".
     "                    <td></td>\n".
     "                  </tr>\n".
     "                  <tr>\n".
     "                    <td><input type=\"submit\" name=\"west\" value=\"W\"/></td>\n".
     "                    <td></td>\n".
     "                    <td><input type=\"submit\" name=\"east\" value=\"O\"/></td>\n".
     "                  </tr>\n".
     "                  <tr>\n".
     "                    <td></td>\n".
     "                    <td><input type=\"submit\" name=\"south\" value=\"S\"/></td>\n".
     "                    <td></td>\n".
     "                  </tr>\n".
     "                </table>\n".
     "              </form>\n".
     "            </div>\n";

echo $positionText;

echo "          </div>\n".
     "        </div>\n";


/*
echo "        <div>\n".
     "          <hr />\n".
     "          <a href=\"logout.php\">Beenden</a>.\n".
     "        </div>\n";
*/

